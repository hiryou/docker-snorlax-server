version: "3.2"

services:
  namenode:
    build: ./namenode
    image: bde2020/hadoop-namenode:master
    container_name: namenode
    #hostname: namenode.snorlax.local
    ports:
      - 9870:9870
      - 9000:9000
    volumes:
      - type: volume
        source: /home/hadoop/docker/volumes/hadoop_namenode
        target: /hadoop/dfs/name
      - type: bind
        source: /home/hadoop/docker/volumes/host_shared
        target: /host_shared
        read_only: true
    environment:
      - CLUSTER_NAME=test
    env_file:
      - ./hadoop.env

  datanode1:
    build: ./datanode
    image: bde2020/hadoop-datanode:master
    container_name: datanode1
    ports:
      - 9864:9864
    depends_on:
      - namenode
    volumes:
      - /home/hadoop/docker/volumes/hadoop_datanode1:/hadoop/dfs/data
    environment:
      SERVICE_PRECONDITION: "namenode:9870"
    env_file:
      - ./hadoop.env

  datanode2:
    build: ./datanode
    image: bde2020/hadoop-datanode:master
    container_name: datanode2
    ports:
      - 9865:9864
    depends_on:
      - namenode
    volumes:
      - /home/hadoop/docker/volumes/hadoop_datanode2:/hadoop/dfs/data
    environment:
      SERVICE_PRECONDITION: "namenode:9870"
    env_file:
      - ./hadoop.env

  resourcemanager:
    build: ./resourcemanager
    image: bde2020/hadoop-resourcemanager:master
    container_name: resourcemanager
    depends_on:
      - namenode
      - datanode1
      - datanode2
    environment:
      SERVICE_PRECONDITION: "namenode:9000 namenode:9870 datanode1:9864 datanode2:9864"
    env_file:
      - ./hadoop.env
    ports:
      - "8088:8088"

  #historyserver:
  #  build: ./historyserver
  #  image: bde2020/hadoop-historyserver:master
  #  container_name: historyserver
  #  depends_on:
  #    - namenode
  #    - datanode1
  #    - datanode2
  #  environment:
  #    SERVICE_PRECONDITION: "namenode:9000 namenode:9870 datanode:9864 resourcemanager:8088"
  #  volumes:
  #    - /home/hadoop/docker/volumes/hadoop_historyserver:/hadoop/yarn/timeline
  #  env_file:
  #    - ./hadoop.env

  #nodemanager1:
  #  build: ./nodemanager
  #  image: bde2020/hadoop-nodemanager:master
  #  container_name: nodemanager1
  #  depends_on:
  #    - namenode
  #    - datanode1
  #    - datanode2
  #  environment:
  #    SERVICE_PRECONDITION: "namenode:9000 namenode:9870 datanode:9864 resourcemanager:8088"
  #  env_file:
  #    - ./hadoop.env
